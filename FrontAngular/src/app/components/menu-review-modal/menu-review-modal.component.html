<!-- Modal Overlay -->
<div class="fixed inset-0 z-[100] flex items-center justify-center p-4 animate-fade-in">
  <!-- Backdrop -->
  <div class="absolute inset-0 bg-black/90 backdrop-blur-sm" (click)="onClose()"></div>

  <!-- Modal Content -->
  <div
    class="relative w-full max-w-2xl bg-neutral-900 border border-white/10 rounded-2xl shadow-2xl overflow-hidden animate-scale-in flex flex-col max-h-[90vh]"
    (click)="$event.stopPropagation()">

    <!-- Close Button -->
    <button
      class="absolute top-4 right-4 z-10 w-8 h-8 rounded-full bg-black/50 text-white flex items-center justify-center hover:bg-white hover:text-black transition-colors"
      (click)="onClose()">
      <i class="fas fa-times"></i>
    </button>

    <!-- Header / Image Banner -->
    <div class="relative h-40 flex-shrink-0 bg-neutral-800">
      <img [src]="imageUrl || '/placeholder.svg?height=200&width=600'" [alt]="productName"
        class="w-full h-full object-cover opacity-60">
      <div class="absolute inset-0 bg-gradient-to-t from-neutral-900 via-transparent to-transparent"></div>

      <div class="absolute bottom-4 left-6 right-6 flex justify-between items-end">
        <div>
          <h2 class="text-2xl font-bold text-white mb-1 shadow-black/50 drop-shadow-lg">{{ productName }}</h2>
          <div
            class="flex items-center gap-2 text-accent bg-black/40 px-3 py-1 rounded-full backdrop-blur-md border border-white/5 w-fit">
            <i class="fas fa-star"></i>
            <span class="font-bold">{{ averageRating > 0 ? averageRating : 'Sin Reseñas' }}</span>
            <span class="text-gray-400 text-xs font-normal" *ngIf="averageRating > 0">/ 5</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Body (Scrollable) -->
    <div class="flex-grow overflow-y-auto p-6 space-y-6 custom-scrollbar">

      <!-- Interactive Rating (Visual only if no submit logic here, but keeping logic) -->
      <div class="flex flex-col items-center justify-center py-4 border-b border-white/5">
        <span class="text-gray-400 text-sm mb-2">Tu calificación</span>
        <div class="flex gap-2">
          <ng-container *ngFor="let star of [1,2,3,4,5]">
            <i class="fas text-2xl cursor-pointer transition-transform hover:scale-110"
              [class.text-accent]="star <= rating" [class.text-gray-700]="star > rating" (click)="rating = star"></i>
          </ng-container>
        </div>
      </div>

      <!-- Review List Component -->
      <div class="min-h-[200px]">
        <app-review-list [productId]="productId"></app-review-list>
      </div>
    </div>

    <!-- Footer -->
    <div class="p-4 border-t border-white/10 bg-black/20 flex-shrink-0">
      <button
        class="w-full py-3 bg-white/5 hover:bg-white/10 text-white rounded-xl border border-white/10 transition-colors font-medium flex items-center justify-center gap-2"
        (click)="onClose()">
        <i class="fas fa-arrow-left"></i>
        Volver a la carta
      </button>
    </div>

  </div>
</div>