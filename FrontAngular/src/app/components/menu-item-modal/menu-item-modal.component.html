<!-- Modal Overlay -->
<div class="fixed inset-0 z-[100] flex items-center justify-center p-4 animate-fade-in">
  <!-- Backdrop -->
  <div class="absolute inset-0 bg-black/90 backdrop-blur-sm" (click)="onClose()"></div>

  <!-- Modal Content -->
  <div
    class="relative w-full max-w-lg bg-neutral-900 border border-white/10 rounded-2xl shadow-2xl overflow-hidden animate-scale-in"
    (click)="$event.stopPropagation()">

    <!-- Close Button -->
    <button
      class="absolute top-4 right-4 z-10 w-8 h-8 rounded-full bg-black/50 text-white flex items-center justify-center hover:bg-white hover:text-black transition-colors"
      (click)="onClose()">
      <i class="fas fa-times"></i>
    </button>

    <!-- Header / Image -->
    <div class="relative h-48 sm:h-64 bg-neutral-800">
      <img [src]="imageUrl || '/assets/images/placeholder-food.jpg'" [alt]="itemTitle"
        class="w-full h-full object-cover">
      <div class="absolute inset-0 bg-gradient-to-t from-neutral-900 via-transparent to-transparent"></div>

      <div class="absolute bottom-4 left-6 right-6">
        <h2 class="text-2xl font-bold text-white mb-1 shadow-black/50 drop-shadow-lg">{{ itemTitle }}</h2>
        <div class="inline-block px-3 py-1 bg-accent/90 text-primary font-bold rounded-lg text-sm shadow-lg">
          ${{ price }}
        </div>
      </div>
    </div>

    <!-- Body -->
    <div class="p-6 space-y-8">

      <!-- Quantity -->
      <div>
        <h4 class="text-gray-400 text-sm font-bold uppercase tracking-wider mb-3 flex items-center gap-2">
          <i class="fas fa-calculator text-accent"></i> Cantidad
        </h4>
        <div class="flex items-center justify-between bg-neutral-800 rounded-xl p-2 border border-white/5">
          <button (click)="quantity = quantity - 1; onQuantityChange()" [disabled]="quantity <= 1"
            class="w-10 h-10 rounded-lg bg-white/5 disabled:opacity-30 text-white hover:bg-white/10 flex items-center justify-center transition-colors">
            <i class="fas fa-minus"></i>
          </button>

          <div class="text-center">
            <span class="block text-2xl font-bold text-white">{{ quantity }}</span>
            <span class="text-xs text-gray-500">unidad{{ quantity > 1 ? 'es' : '' }}</span>
          </div>

          <button (click)="quantity = quantity + 1; onQuantityChange()"
            class="w-10 h-10 rounded-lg bg-accent text-primary font-bold hover:bg-accent-hover flex items-center justify-center transition-colors shadow-lg shadow-accent/20">
            <i class="fas fa-plus"></i>
          </button>
        </div>
      </div>

      <!-- Comments -->
      <div>
        <h4 class="text-gray-400 text-sm font-bold uppercase tracking-wider mb-3 flex items-center gap-2">
          <i class="fas fa-comment-alt text-accent"></i> Comentarios especiales
        </h4>
        <div class="relative">
          <textarea [(ngModel)]="comment" placeholder="¿Alguna instrucción especial? (ej: sin cebolla, extra queso...)"
            rows="3"
            class="w-full bg-neutral-800 border-none rounded-xl text-white placeholder-gray-600 p-4 focus:ring-1 focus:ring-accent resize-none focus:bg-neutral-800/80 transition-all font-light"></textarea>
          <div class="absolute bottom-3 right-3 text-xs text-gray-600">
            {{ comment.length }}/200
          </div>
        </div>
      </div>

    </div>

    <!-- Footer -->
    <div class="p-6 border-t border-white/10 bg-black/20">
      <div class="flex justify-between items-center mb-4">
        <span class="text-gray-400">Total a pagar:</span>
        <span class="text-2xl font-bold text-white">${{ getTotalPrice().toFixed(2) }}</span>
      </div>

      <div class="grid grid-cols-2 gap-4">
        <button
          class="py-3 px-4 rounded-xl border border-white/10 text-gray-400 hover:text-white hover:bg-white/5 transition-colors font-medium"
          (click)="onClose()">
          Cancelar
        </button>
        <button
          class="py-3 px-4 rounded-xl bg-accent text-primary font-bold hover:bg-accent-hover transition-all flex items-center justify-center gap-2 shadow-lg shadow-accent/20 disabled:opacity-50 disabled:cursor-not-allowed"
          (click)="onAddToCart()" [disabled]="isProcessing">
          <i class="fas fa-shopping-cart" *ngIf="!isProcessing"></i>
          <i class="fas fa-spinner fa-spin" *ngIf="isProcessing"></i>
          <span>{{ isProcessing ? 'Agregando...' : 'Agregar al Pedido' }}</span>
        </button>
      </div>
    </div>

  </div>
</div>